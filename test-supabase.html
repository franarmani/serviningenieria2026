<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #8B0000; }
        button {
            background: #8B0000;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #660000; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 500px;
            overflow-y: auto;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Conexi√≥n Supabase</h1>
        
        <div>
            <button onclick="testConnection()">1Ô∏è‚É£ Test Conexi√≥n</button>
            <button onclick="checkTable()">2Ô∏è‚É£ Verificar Tabla</button>
            <button onclick="listNews()">3Ô∏è‚É£ Listar Novedades</button>
            <button onclick="insertSample()">4Ô∏è‚É£ Insertar 1 Novedad</button>
            <button onclick="deleteAll()">5Ô∏è‚É£ Limpiar Todo</button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xaijqiwlguoxjxrbhraa.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhaWpxaXdsZ3VveGp4cmJocmFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY0NTUzMzksImV4cCI6MjA1MjAzMTMzOX0.EcRFNP2OrvkS5r3GEw-XdG9V0NU7Y0j_iJjdWYO_aDw';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showResult(message, type = 'info') {
            const div = document.getElementById('result');
            div.textContent = message;
            div.className = `result ${type}`;
        }

        async function testConnection() {
            showResult('‚è≥ Probando conexi√≥n...', 'info');
            try {
                const { data, error } = await supabase.from('news').select('count');
                if (error) throw error;
                showResult('‚úÖ Conexi√≥n exitosa!\n\nSupabase est√° conectado correctamente.', 'success');
            } catch (error) {
                showResult(`‚ùå Error de conexi√≥n:\n\n${error.message}\n\nCode: ${error.code}\n\nDetails: ${JSON.stringify(error, null, 2)}`, 'error');
            }
        }

        async function checkTable() {
            showResult('‚è≥ Verificando tabla news...', 'info');
            try {
                const { data, error } = await supabase
                    .from('news')
                    .select('*')
                    .limit(0);
                
                if (error) throw error;
                showResult(`‚úÖ Tabla 'news' existe!\n\nEstructura verificada correctamente.`, 'success');
            } catch (error) {
                showResult(`‚ùå Error:\n\n${error.message}\n\n${error.hint || ''}\n\n¬øEjecutaste el SQL schema en Supabase?`, 'error');
            }
        }

        async function listNews() {
            showResult('‚è≥ Listando novedades...', 'info');
            try {
                const { data, error } = await supabase
                    .from('news')
                    .select('*')
                    .order('date', { ascending: false });
                
                if (error) throw error;
                
                if (data.length === 0) {
                    showResult('‚ÑπÔ∏è No hay novedades en la base de datos.\n\nUsa el bot√≥n "4Ô∏è‚É£ Insertar 1 Novedad" para agregar una.', 'info');
                } else {
                    showResult(`‚úÖ Se encontraron ${data.length} novedades:\n\n${JSON.stringify(data, null, 2)}`, 'success');
                }
            } catch (error) {
                showResult(`‚ùå Error al listar:\n\n${error.message}`, 'error');
            }
        }

        async function insertSample() {
            showResult('‚è≥ Insertando novedad de prueba...', 'info');
            
            const testNews = {
                title: 'Prueba de Inserci√≥n',
                title_en: 'Insert Test',
                summary: 'Esta es una novedad de prueba para verificar que Supabase funciona correctamente.',
                summary_en: 'This is a test news item to verify Supabase is working correctly.',
                content: JSON.stringify([{
                    id: '1',
                    type: 'text',
                    content: 'Contenido de prueba'
                }]),
                content_en: JSON.stringify([{
                    id: '1',
                    type: 'text',
                    content: 'Test content'
                }]),
                category: 'Empresa',
                image: '/about/servin-logo.webp',
                date: new Date().toISOString().split('T')[0],
                status: 'published',
                featured: false
            };

            try {
                const { data, error } = await supabase
                    .from('news')
                    .insert([testNews])
                    .select();
                
                if (error) throw error;
                showResult(`‚úÖ Novedad insertada exitosamente!\n\n${JSON.stringify(data, null, 2)}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error al insertar:\n\n${error.message}\n\nDetalles: ${JSON.stringify(error, null, 2)}`, 'error');
            }
        }

        async function deleteAll() {
            if (!confirm('¬øEst√°s seguro de eliminar TODAS las novedades?')) return;
            
            showResult('‚è≥ Eliminando todas las novedades...', 'info');
            try {
                const { error } = await supabase
                    .from('news')
                    .delete()
                    .neq('id', '00000000-0000-0000-0000-000000000000');
                
                if (error) throw error;
                showResult('‚úÖ Todas las novedades fueron eliminadas.', 'success');
            } catch (error) {
                showResult(`‚ùå Error al eliminar:\n\n${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
